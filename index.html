<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>工程試算工具</title>
    <style>
        :root {
            --primary: #2563eb;
            --primary-dark: #1d4ed8;
            --bg: #f1f5f9;
            --card: #ffffff;
            --text: #1e293b;
            --text-secondary: #64748b;
            --border: #e2e8f0;
            --success: #16a34a;
            --accent: #f59e0b;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Microsoft JhengHei", sans-serif;
            background: var(--bg);
            color: var(--text);
            line-height: 1.6;
        }

        header {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            padding: 1.5rem 2rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.15);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        header h1 { font-size: 1.5rem; font-weight: 700; }
        header p { font-size: 0.85rem; opacity: 0.85; margin-top: 0.25rem; }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 1.5rem;
        }

        /* Tab Navigation */
        .tab-nav {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
            background: var(--card);
            padding: 0.75rem;
            border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.08);
        }

        .tab-btn {
            padding: 0.6rem 1.2rem;
            border: 2px solid transparent;
            background: var(--bg);
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 500;
            color: var(--text-secondary);
            transition: all 0.2s;
        }

        .tab-btn:hover { background: #e0e7ff; color: var(--primary); }
        .tab-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .tab-content { display: none; }
        .tab-content.active { display: block; }

        /* Cards */
        .card {
            background: var(--card);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 1px 3px rgba(0,0,0,0.08);
        }

        .card h2 {
            font-size: 1.2rem;
            margin-bottom: 0.25rem;
            color: var(--primary);
        }

        .card .subtitle {
            font-size: 0.85rem;
            color: var(--text-secondary);
            margin-bottom: 1rem;
            padding-bottom: 0.75rem;
            border-bottom: 1px solid var(--border);
        }

        .formula-display {
            background: #f8fafc;
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 0.75rem 1rem;
            margin-bottom: 1rem;
            font-family: "Cambria Math", "Times New Roman", serif;
            font-size: 1rem;
            color: var(--text-secondary);
            text-align: center;
        }

        /* Form */
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 1rem;
        }

        .form-group { display: flex; flex-direction: column; }

        .form-group label {
            font-size: 0.85rem;
            font-weight: 600;
            margin-bottom: 0.3rem;
            color: var(--text);
        }

        .form-group label span {
            font-weight: 400;
            color: var(--text-secondary);
            font-size: 0.8rem;
        }

        .form-group input, .form-group select {
            padding: 0.6rem 0.75rem;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-size: 0.95rem;
            transition: border-color 0.2s;
            background: white;
        }

        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: var(--primary);
        }

        .input-unit-group {
            display: flex;
            gap: 0;
        }

        .input-unit-group input {
            flex: 1;
            border-radius: 8px 0 0 8px;
            border-right: none;
            min-width: 0;
        }

        .input-unit-group select.unit-select {
            width: auto;
            min-width: 70px;
            max-width: 100px;
            border-radius: 0 8px 8px 0;
            border-left: 1px solid var(--border);
            font-size: 0.8rem;
            padding: 0.4rem 0.3rem;
            background: #f8fafc;
            color: var(--text-secondary);
            cursor: pointer;
        }

        .input-unit-group select.unit-select:focus {
            border-color: var(--primary);
        }

        .btn {
            display: inline-flex;
            align-items: center;
            gap: 0.4rem;
            padding: 0.7rem 1.5rem;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s;
            margin-top: 1rem;
        }

        .btn:hover { background: var(--primary-dark); }

        .btn-secondary {
            background: #64748b;
        }
        .btn-secondary:hover { background: #475569; }

        /* Results */
        .result-box {
            margin-top: 1rem;
            padding: 1rem 1.25rem;
            background: #f0fdf4;
            border: 2px solid #bbf7d0;
            border-radius: 8px;
            display: none;
        }

        .result-box.show { display: block; }

        .result-box h3 {
            font-size: 0.9rem;
            color: var(--success);
            margin-bottom: 0.5rem;
        }

        .result-item {
            display: flex;
            justify-content: space-between;
            padding: 0.4rem 0;
            border-bottom: 1px dashed #e2e8f0;
        }

        .result-item:last-child { border-bottom: none; }

        .result-item .label { color: var(--text-secondary); font-size: 0.9rem; }
        .result-item .value { font-weight: 700; color: var(--text); font-size: 0.95rem; }

        /* Diagram */
        .diagram-container {
            text-align: center;
            margin: 1rem 0;
        }

        .diagram-container svg {
            max-width: 100%;
            height: auto;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .container { padding: 1rem; }
            .tab-nav { gap: 0.35rem; padding: 0.5rem; }
            .tab-btn { padding: 0.5rem 0.8rem; font-size: 0.8rem; }
            .form-grid { grid-template-columns: 1fr; }
        }

        /* Print */
        @media print {
            header { position: static; }
            .tab-nav, .btn { display: none; }
            .tab-content { display: block !important; }
            .card { break-inside: avoid; box-shadow: none; border: 1px solid #ccc; }
        }

        .unit-system-selector {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .unit-system-selector label {
            font-size: 0.85rem;
            opacity: 0.85;
        }
        .unit-system-selector select {
            padding: 0.4rem 0.6rem;
            border: none;
            border-radius: 6px;
            font-size: 0.9rem;
            font-weight: 600;
            background: rgba(255,255,255,0.2);
            color: white;
            cursor: pointer;
        }
        .unit-system-selector select option {
            color: #1e293b;
            background: white;
        }

        footer {
            text-align: center;
            padding: 2rem;
            color: var(--text-secondary);
            font-size: 0.8rem;
        }
    </style>
</head>
<body>

<header>
    <div style="display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:0.5rem;">
        <div>
            <h1>&#9881; 工程試算工具</h1>
            <p>Engineering Calculator - 結構 / 材料 / 單位換算</p>
        </div>
        <div class="unit-system-selector">
            <label for="unit-system">單位制</label>
            <select id="unit-system" onchange="switchUnitSystem(this.value)">
                <option value="" selected>自訂</option>
                <option value="kN-m">kN - m</option>
                <option value="kgf-cm">Kgf - cm</option>
                <option value="tf-m">tf - m</option>
                <option value="N-mm">N - mm</option>
                <option value="tf-cm">tf - cm</option>
                <option value="kgf-m">Kgf - m</option>
            </select>
        </div>
    </div>
</header>

<div class="container">
    <nav class="tab-nav">
        <button class="tab-btn active" data-tab="beam">梁分析</button>
        <button class="tab-btn" data-tab="column">柱載重</button>
        <button class="tab-btn" data-tab="concrete">混凝土用量</button>
        <button class="tab-btn" data-tab="rebar">鋼筋計算</button>
        <button class="tab-btn" data-tab="rcbeam">RC梁設計</button>
        <button class="tab-btn" data-tab="unit">單位換算</button>
    </nav>

    <!-- ==================== 梁分析 ==================== -->
    <div class="tab-content active" id="tab-beam">
        <div class="card">
            <h2>簡支梁分析</h2>
            <p class="subtitle">均佈載重下的簡支梁 - 彎矩、剪力、撓度計算</p>
            <div class="formula-display">
                M_max = wL&sup2;/8 &nbsp;&nbsp;|&nbsp;&nbsp; V_max = wL/2 &nbsp;&nbsp;|&nbsp;&nbsp; &delta;_max = 5wL⁴ / (384EI)
            </div>
            <div class="diagram-container">
                <svg width="400" height="100" viewBox="0 0 400 100">
                    <line x1="50" y1="60" x2="350" y2="60" stroke="#2563eb" stroke-width="4"/>
                    <polygon points="50,60 40,80 60,80" fill="#2563eb"/>
                    <polygon points="350,60 340,80 360,80" fill="#2563eb"/>
                    <line x1="50" y1="80" x2="360" y2="80" stroke="#94a3b8" stroke-width="1"/>
                    <!-- arrows for distributed load -->
                    <g stroke="#ef4444" stroke-width="1.5" fill="#ef4444">
                        <line x1="80" y1="20" x2="80" y2="55"/><polygon points="80,55 76,47 84,47"/>
                        <line x1="120" y1="20" x2="120" y2="55"/><polygon points="120,55 116,47 124,47"/>
                        <line x1="160" y1="20" x2="160" y2="55"/><polygon points="160,55 156,47 164,47"/>
                        <line x1="200" y1="20" x2="200" y2="55"/><polygon points="200,55 196,47 204,47"/>
                        <line x1="240" y1="20" x2="240" y2="55"/><polygon points="240,55 236,47 244,47"/>
                        <line x1="280" y1="20" x2="280" y2="55"/><polygon points="280,55 276,47 284,47"/>
                        <line x1="320" y1="20" x2="320" y2="55"/><polygon points="320,55 316,47 324,47"/>
                    </g>
                    <line x1="75" y1="17" x2="325" y2="17" stroke="#ef4444" stroke-width="1.5"/>
                    <text x="200" y="12" text-anchor="middle" fill="#ef4444" font-size="12">w (kN/m)</text>
                    <text x="200" y="96" text-anchor="middle" fill="#64748b" font-size="12">L</text>
                </svg>
            </div>
            <div class="form-grid">
                <div class="form-group">
                    <label>跨距 L <span>(m)</span></label>
                    <input type="number" id="beam-L" value="6" step="0.1" min="0.1">
                </div>
                <div class="form-group">
                    <label>均佈載重 w <span>(kN/m)</span></label>
                    <input type="number" id="beam-w" value="10" step="0.1" min="0">
                </div>
                <div class="form-group">
                    <label>彈性模數 E <span>(GPa)</span></label>
                    <input type="number" id="beam-E" value="200" step="1" min="1">
                </div>
                <div class="form-group">
                    <label>慣性矩 I <span>(cm⁴)</span></label>
                    <input type="number" id="beam-I" value="8356" step="1" min="1">
                </div>
            </div>
            <button class="btn" onclick="calcBeam()">計算</button>
            <div class="result-box" id="result-beam">
                <h3>計算結果</h3>
                <div id="result-beam-content"></div>
            </div>
        </div>
    </div>

    <!-- ==================== 柱載重 ==================== -->
    <div class="tab-content" id="tab-column">
        <div class="card">
            <h2>柱軸壓載重分析</h2>
            <p class="subtitle">Euler 挫屈載重 & 容許軸壓力計算</p>
            <div class="formula-display">
                P_cr = &pi;&sup2;EI / (KL)&sup2; &nbsp;&nbsp;|&nbsp;&nbsp; &sigma; = P / A
            </div>
            <div class="form-grid">
                <div class="form-group">
                    <label>彈性模數 E <span>(GPa)</span></label>
                    <input type="number" id="col-E" value="200" step="1">
                </div>
                <div class="form-group">
                    <label>慣性矩 I <span>(cm⁴)</span></label>
                    <input type="number" id="col-I" value="5696" step="1">
                </div>
                <div class="form-group">
                    <label>斷面積 A <span>(cm&sup2;)</span></label>
                    <input type="number" id="col-A" value="76.4" step="0.1">
                </div>
                <div class="form-group">
                    <label>柱長度 L <span>(m)</span></label>
                    <input type="number" id="col-L" value="4" step="0.1">
                </div>
                <div class="form-group">
                    <label>有效長度係數 K</label>
                    <select id="col-K">
                        <option value="0.5">0.5 - 兩端固定</option>
                        <option value="0.7">0.7 - 一端固定一端鉸</option>
                        <option value="1.0" selected>1.0 - 兩端鉸接</option>
                        <option value="2.0">2.0 - 一端固定一端自由</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>軸壓力 P <span>(kN)</span></label>
                    <input type="number" id="col-P" value="500" step="1">
                </div>
            </div>
            <button class="btn" onclick="calcColumn()">計算</button>
            <div class="result-box" id="result-column">
                <h3>計算結果</h3>
                <div id="result-column-content"></div>
            </div>
        </div>
    </div>

    <!-- ==================== 混凝土用量 ==================== -->
    <div class="tab-content" id="tab-concrete">
        <div class="card">
            <h2>混凝土用量估算</h2>
            <p class="subtitle">依據構件尺寸計算混凝土體積、重量及預拌車數</p>
            <div class="form-grid">
                <div class="form-group">
                    <label>構件類型</label>
                    <select id="conc-type" onchange="toggleConcShape()">
                        <option value="rect">矩形 (板/梁/牆/基礎)</option>
                        <option value="cylinder">圓柱</option>
                    </select>
                </div>
                <div class="form-group" id="conc-w-group">
                    <label>寬度 <span>(m)</span></label>
                    <input type="number" id="conc-w" value="0.4" step="0.01">
                </div>
                <div class="form-group" id="conc-d-group" style="display:none;">
                    <label>直徑 <span>(m)</span></label>
                    <input type="number" id="conc-d" value="0.6" step="0.01">
                </div>
                <div class="form-group">
                    <label>高度/深度 <span>(m)</span></label>
                    <input type="number" id="conc-h" value="0.6" step="0.01">
                </div>
                <div class="form-group">
                    <label>長度 <span>(m)</span></label>
                    <input type="number" id="conc-l" value="8" step="0.1">
                </div>
                <div class="form-group">
                    <label>數量 <span>(支/片)</span></label>
                    <input type="number" id="conc-n" value="1" step="1" min="1">
                </div>
                <div class="form-group">
                    <label>損耗率 <span>(%)</span></label>
                    <input type="number" id="conc-loss" value="5" step="1" min="0">
                </div>
            </div>
            <button class="btn" onclick="calcConcrete()">計算</button>
            <div class="result-box" id="result-concrete">
                <h3>計算結果</h3>
                <div id="result-concrete-content"></div>
            </div>
        </div>
    </div>

    <!-- ==================== 鋼筋計算 ==================== -->
    <div class="tab-content" id="tab-rebar">
        <div class="card">
            <h2>鋼筋數量與重量計算</h2>
            <p class="subtitle">依據鋼筋號數計算單位重量、總重量</p>
            <div class="form-grid">
                <div class="form-group">
                    <label>鋼筋號數</label>
                    <select id="rebar-no">
                        <option value="3">D10 (#3) - 0.560 kg/m</option>
                        <option value="4" selected>D13 (#4) - 0.994 kg/m</option>
                        <option value="5">D16 (#5) - 1.552 kg/m</option>
                        <option value="6">D19 (#6) - 2.235 kg/m</option>
                        <option value="7">D22 (#7) - 2.985 kg/m</option>
                        <option value="8">D25 (#8) - 3.980 kg/m</option>
                        <option value="9">D29 (#9) - 5.080 kg/m</option>
                        <option value="10">D32 (#10) - 6.390 kg/m</option>
                        <option value="11">D36 (#11) - 7.900 kg/m</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>單支長度 <span>(m)</span></label>
                    <input type="number" id="rebar-len" value="6" step="0.1">
                </div>
                <div class="form-group">
                    <label>支數</label>
                    <input type="number" id="rebar-qty" value="20" step="1" min="1">
                </div>
                <div class="form-group">
                    <label>搭接率 <span>(%)</span></label>
                    <input type="number" id="rebar-lap" value="10" step="1" min="0">
                </div>
            </div>
            <button class="btn" onclick="calcRebar()">計算</button>
            <div class="result-box" id="result-rebar">
                <h3>計算結果</h3>
                <div id="result-rebar-content"></div>
            </div>
        </div>
    </div>

    <!-- ==================== RC梁設計 ==================== -->
    <div class="tab-content" id="tab-rcbeam">
        <div class="card">
            <h2>RC梁撓曲設計 (ACI 318)</h2>
            <p class="subtitle">單筋矩形梁 - 依設計彎矩求所需鋼筋量</p>
            <div class="formula-display">
                &phi;Mn &ge; Mu &nbsp;&nbsp;|&nbsp;&nbsp; a = As&middot;fy / (0.85&middot;f'c&middot;b) &nbsp;&nbsp;|&nbsp;&nbsp; Mn = As&middot;fy&middot;(d - a/2)
            </div>
            <div class="diagram-container">
                <svg width="360" height="180" viewBox="0 0 360 180">
                    <!-- beam cross section -->
                    <rect x="80" y="10" width="100" height="160" fill="none" stroke="#2563eb" stroke-width="2"/>
                    <!-- concrete fill -->
                    <rect x="80" y="10" width="100" height="160" fill="#e0e7ff" opacity="0.5"/>
                    <!-- rebar circles -->
                    <circle cx="105" cy="145" r="6" fill="#ef4444"/>
                    <circle cx="130" cy="145" r="6" fill="#ef4444"/>
                    <circle cx="155" cy="145" r="6" fill="#ef4444"/>
                    <!-- dimensions: b -->
                    <line x1="80" y1="178" x2="180" y2="178" stroke="#64748b" stroke-width="1"/>
                    <line x1="80" y1="174" x2="80" y2="178" stroke="#64748b" stroke-width="1"/>
                    <line x1="180" y1="174" x2="180" y2="178" stroke="#64748b" stroke-width="1"/>
                    <text x="130" y="176" text-anchor="middle" fill="#64748b" font-size="11">b</text>
                    <!-- dimensions: h -->
                    <line x1="72" y1="10" x2="72" y2="170" stroke="#64748b" stroke-width="1"/>
                    <line x1="68" y1="10" x2="76" y2="10" stroke="#64748b" stroke-width="1"/>
                    <line x1="68" y1="170" x2="76" y2="170" stroke="#64748b" stroke-width="1"/>
                    <text x="64" y="94" text-anchor="middle" fill="#64748b" font-size="11" transform="rotate(-90,64,94)">h</text>
                    <!-- dimensions: d -->
                    <line x1="188" y1="10" x2="188" y2="145" stroke="#ef4444" stroke-width="1" stroke-dasharray="4"/>
                    <line x1="184" y1="10" x2="192" y2="10" stroke="#ef4444" stroke-width="1"/>
                    <line x1="184" y1="145" x2="192" y2="145" stroke="#ef4444" stroke-width="1"/>
                    <text x="198" y="82" fill="#ef4444" font-size="11">d</text>
                    <!-- stress block -->
                    <rect x="230" y="10" width="60" height="50" fill="#3b82f6" opacity="0.3" stroke="#2563eb" stroke-width="1"/>
                    <text x="260" y="38" text-anchor="middle" fill="#2563eb" font-size="10">0.85f'c</text>
                    <text x="260" y="68" text-anchor="middle" fill="#2563eb" font-size="10">a</text>
                    <!-- arrow a -->
                    <line x1="295" y1="10" x2="295" y2="60" stroke="#2563eb" stroke-width="1"/>
                    <polygon points="295,10 292,18 298,18" fill="#2563eb"/>
                    <polygon points="295,60 292,52 298,52" fill="#2563eb"/>
                    <!-- tension force -->
                    <line x1="260" y1="145" x2="260" y2="145" stroke="#ef4444" stroke-width="1"/>
                    <text x="260" y="150" text-anchor="middle" fill="#ef4444" font-size="10">As&middot;fy</text>
                </svg>
            </div>
            <div class="form-grid">
                <div class="form-group">
                    <label>梁寬 b <span>(cm)</span></label>
                    <input type="number" id="rc-b" value="30" step="1" min="1">
                </div>
                <div class="form-group">
                    <label>梁深 h <span>(cm)</span></label>
                    <input type="number" id="rc-h" value="60" step="1" min="1">
                </div>
                <div class="form-group">
                    <label>有效深度 d <span>(cm)</span></label>
                    <input type="number" id="rc-d" value="54" step="0.5" min="1">
                </div>
                <div class="form-group">
                    <label>混凝土強度 f'c <span>(kgf/cm&sup2;)</span></label>
                    <input type="number" id="rc-fc" value="280" step="10" min="1">
                </div>
                <div class="form-group">
                    <label>鋼筋降伏強度 fy <span>(kgf/cm&sup2;)</span></label>
                    <input type="number" id="rc-fy" value="4200" step="100" min="1">
                </div>
                <div class="form-group">
                    <label>設計彎矩 Mu <span>(tf&middot;m)</span></label>
                    <input type="number" id="rc-Mu" value="15" step="0.5" min="0">
                </div>
                <div class="form-group">
                    <label>強度折減係數 &phi;</label>
                    <input type="number" id="rc-phi" value="0.9" step="0.05" min="0.1" max="1">
                </div>
            </div>
            <button class="btn" onclick="calcRCBeam()">設計計算</button>
            <div class="result-box" id="result-rcbeam">
                <h3>設計結果</h3>
                <div id="result-rcbeam-content"></div>
            </div>
        </div>
    </div>

    <!-- ==================== 單位換算 ==================== -->
    <div class="tab-content" id="tab-unit">
        <div class="card">
            <h2>工程單位換算</h2>
            <p class="subtitle">常用工程單位快速換算</p>
            <div class="form-grid">
                <div class="form-group">
                    <label>換算類別</label>
                    <select id="unit-cat" onchange="updateUnitOptions()">
                        <option value="length">長度</option>
                        <option value="area">面積</option>
                        <option value="volume">體積</option>
                        <option value="force">力</option>
                        <option value="pressure">壓力</option>
                        <option value="moment">彎矩</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>數值</label>
                    <input type="number" id="unit-val" value="1" step="any">
                </div>
                <div class="form-group">
                    <label>從</label>
                    <select id="unit-from"></select>
                </div>
                <div class="form-group">
                    <label>到</label>
                    <select id="unit-to"></select>
                </div>
            </div>
            <button class="btn" onclick="calcUnit()">換算</button>
            <div class="result-box" id="result-unit">
                <h3>換算結果</h3>
                <div id="result-unit-content"></div>
            </div>
        </div>
    </div>
</div>

<footer>
    <p>工程試算工具 &copy; 2026 | 僅供參考，實際工程設計請依規範辦理</p>
</footer>

<script>
// ===== Tab Switching =====
document.querySelectorAll('.tab-btn').forEach(btn => {
    btn.addEventListener('click', () => {
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
        btn.classList.add('active');
        document.getElementById('tab-' + btn.dataset.tab).classList.add('active');
    });
});

// ===== Helpers =====
function val(id) { return parseFloat(document.getElementById(id).value) || 0; }
function sel(id) { return document.getElementById(id).value; }

function showResult(id, items) {
    const box = document.getElementById('result-' + id);
    const content = document.getElementById('result-' + id + '-content');
    content.innerHTML = items.map(([label, value]) =>
        `<div class="result-item"><span class="label">${label}</span><span class="value">${value}</span></div>`
    ).join('');
    box.classList.add('show');
}

function fmt(n, d = 4) {
    if (Math.abs(n) >= 1e6 || (Math.abs(n) < 0.001 && n !== 0)) return n.toExponential(d);
    return parseFloat(n.toFixed(d)).toLocaleString('en-US', { maximumFractionDigits: d });
}

// ===== SI 轉換因子 (所有單位 → SI 基準) =====
const factorsToSI = {
    // Force → N
    'N': 1, 'kN': 1e3, 'kgf': 9.80665, 'tf': 9806.65, 'lbf': 4.44822,
    // Length → m
    'm': 1, 'cm': 0.01, 'mm': 0.001, 'ft': 0.3048, 'in': 0.0254,
    // Stress → Pa
    'Pa': 1, 'kPa': 1e3, 'MPa': 1e6, 'GPa': 1e9,
    'kN/m\u00B2': 1e3, 'kgf/cm\u00B2': 98066.5, 'tf/m\u00B2': 9806.65,
    'N/mm\u00B2': 1e6, 'tf/cm\u00B2': 98066500, 'kgf/m\u00B2': 9.80665,
    'ksi': 6894760, 'psi': 6894.76,
    // Moment → N·m
    'kN\u00B7m': 1e3, 'N\u00B7m': 1, 'kgf\u00B7cm': 0.0980665,
    'tf\u00B7m': 9806.65, 'N\u00B7mm': 0.001, 'tf\u00B7cm': 98.0665,
    'kgf\u00B7m': 9.80665, 'lbf\u00B7ft': 1.35582,
    // Distributed load → N/m
    'kN/m': 1e3, 'N/m': 1, 'kgf/cm': 980.665, 'tf/m': 9806.65,
    'N/mm': 1e3, 'tf/cm': 980665, 'kgf/m': 9.80665, 'lbf/ft': 14.5939,
    // Area → m²
    'm\u00B2': 1, 'cm\u00B2': 1e-4, 'mm\u00B2': 1e-6, 'in\u00B2': 6.4516e-4,
    // Inertia → m⁴
    'm\u2074': 1, 'cm\u2074': 1e-8, 'mm\u2074': 1e-12, 'in\u2074': 4.162314e-7,
    // Unit weight → N/m³
    'kN/m\u00B3': 1e3, 'kgf/cm\u00B3': 9806650, 'tf/m\u00B3': 9806.65,
    'N/mm\u00B3': 1e9, 'tf/cm\u00B3': 9.80665e9, 'kgf/m\u00B3': 9.80665, 'pcf': 157.087,
};

// ===== 單位制定義 =====
const unitSystemDefs = {
    'kN-m':   { length:'m',  force:'kN',  stress:'kN/m\u00B2',   load:'kN/m',   area:'m\u00B2',  inertia:'m\u2074',  unitweight:'kN/m\u00B3',  moment:'kN\u00B7m' },
    'kgf-cm': { length:'cm', force:'kgf', stress:'kgf/cm\u00B2', load:'kgf/cm', area:'cm\u00B2', inertia:'cm\u2074', unitweight:'kgf/cm\u00B3', moment:'kgf\u00B7cm' },
    'tf-m':   { length:'m',  force:'tf',  stress:'tf/m\u00B2',   load:'tf/m',   area:'m\u00B2',  inertia:'m\u2074',  unitweight:'tf/m\u00B3',  moment:'tf\u00B7m' },
    'N-mm':   { length:'mm', force:'N',   stress:'N/mm\u00B2',   load:'N/mm',   area:'mm\u00B2', inertia:'mm\u2074', unitweight:'N/mm\u00B3',  moment:'N\u00B7mm' },
    'tf-cm':  { length:'cm', force:'tf',  stress:'tf/cm\u00B2',  load:'tf/cm',  area:'cm\u00B2', inertia:'cm\u2074', unitweight:'tf/cm\u00B3', moment:'tf\u00B7cm' },
    'kgf-m':  { length:'m',  force:'kgf', stress:'kgf/m\u00B2',  load:'kgf/m',  area:'m\u00B2',  inertia:'m\u2074',  unitweight:'kgf/m\u00B3', moment:'kgf\u00B7m' },
};

// ===== 單位定義 (含維度類型) =====
const fieldUnits = {
    // -- 梁分析 --
    'beam-L':  { dflt: 'm',    dim: 'length', units: { 'm': 1, 'cm': 0.01, 'mm': 0.001, 'ft': 0.3048, 'in': 0.0254 } },
    'beam-w':  { dflt: 'kN/m', dim: 'load',   units: { 'kN/m': 1, 'kgf/cm': 0.980665, 'tf/m': 9.80665, 'N/mm': 1, 'tf/cm': 980.665, 'kgf/m': 0.00980665, 'N/m': 0.001, 'lbf/ft': 0.0145939 } },
    'beam-E':  { dflt: 'GPa',  dim: 'stress', units: { 'GPa': 1e6, 'MPa': 1e3, 'kN/m\u00B2': 1, 'kgf/cm\u00B2': 98.0665, 'tf/m\u00B2': 9.80665, 'N/mm\u00B2': 1e3, 'tf/cm\u00B2': 98066.5, 'kgf/m\u00B2': 0.00980665, 'ksi': 6.89476e3 } },
    'beam-I':  { dflt: 'cm\u2074', dim: 'inertia', units: { 'm\u2074': 1, 'cm\u2074': 1e-8, 'mm\u2074': 1e-12, 'in\u2074': 4.162314e-7 } },

    // -- 柱載重 --
    'col-E':   { dflt: 'GPa',  dim: 'stress', units: { 'GPa': 1e6, 'MPa': 1e3, 'kN/m\u00B2': 1, 'kgf/cm\u00B2': 98.0665, 'tf/m\u00B2': 9.80665, 'N/mm\u00B2': 1e3, 'tf/cm\u00B2': 98066.5, 'kgf/m\u00B2': 0.00980665, 'ksi': 6.89476e3 } },
    'col-I':   { dflt: 'cm\u2074', dim: 'inertia', units: { 'm\u2074': 1, 'cm\u2074': 1e-8, 'mm\u2074': 1e-12, 'in\u2074': 4.162314e-7 } },
    'col-A':   { dflt: 'cm\u00B2', dim: 'area', units: { 'm\u00B2': 1, 'cm\u00B2': 1e-4, 'mm\u00B2': 1e-6, 'in\u00B2': 6.4516e-4 } },
    'col-L':   { dflt: 'm',    dim: 'length', units: { 'm': 1, 'cm': 0.01, 'mm': 0.001, 'ft': 0.3048 } },
    'col-P':   { dflt: 'kN',   dim: 'force', units: { 'kN': 1, 'N': 0.001, 'kgf': 0.00980665, 'tf': 9.80665, 'lbf': 0.00444822 } },

    // -- 混凝土 --
    'conc-w':  { dflt: 'm', dim: 'length', units: { 'm': 1, 'cm': 0.01, 'mm': 0.001, 'ft': 0.3048, 'in': 0.0254 } },
    'conc-d':  { dflt: 'm', dim: 'length', units: { 'm': 1, 'cm': 0.01, 'mm': 0.001, 'ft': 0.3048, 'in': 0.0254 } },
    'conc-h':  { dflt: 'm', dim: 'length', units: { 'm': 1, 'cm': 0.01, 'mm': 0.001, 'ft': 0.3048, 'in': 0.0254 } },
    'conc-l':  { dflt: 'm', dim: 'length', units: { 'm': 1, 'cm': 0.01, 'mm': 0.001, 'ft': 0.3048, 'in': 0.0254 } },

    // -- 鋼筋 --
    'rebar-len': { dflt: 'm', dim: 'length', units: { 'm': 1, 'cm': 0.01, 'mm': 0.001, 'ft': 0.3048 } },

    // -- RC梁設計 --
    'rc-b':  { dflt: 'cm', dim: 'length', units: { 'cm': 1, 'mm': 0.1, 'm': 100, 'in': 2.54 } },
    'rc-h':  { dflt: 'cm', dim: 'length', units: { 'cm': 1, 'mm': 0.1, 'm': 100, 'in': 2.54 } },
    'rc-d':  { dflt: 'cm', dim: 'length', units: { 'cm': 1, 'mm': 0.1, 'm': 100, 'in': 2.54 } },
    'rc-fc': { dflt: 'kgf/cm\u00B2', dim: 'stress', units: { 'kgf/cm\u00B2': 1, 'MPa': 10.1972, 'N/mm\u00B2': 10.1972, 'tf/m\u00B2': 1e4, 'kN/m\u00B2': 0.0101972, 'psi': 0.070307 } },
    'rc-fy': { dflt: 'kgf/cm\u00B2', dim: 'stress', units: { 'kgf/cm\u00B2': 1, 'MPa': 10.1972, 'N/mm\u00B2': 10.1972, 'tf/m\u00B2': 1e4, 'kN/m\u00B2': 0.0101972, 'psi': 0.070307 } },
    'rc-Mu': { dflt: 'tf\u00B7m', dim: 'moment', units: { 'tf\u00B7m': 1, 'kN\u00B7m': 0.101972, 'kgf\u00B7cm': 1e5, 'kgf\u00B7m': 1e3, 'N\u00B7mm': 1.01972e-7, 'tf\u00B7cm': 100, 'N\u00B7m': 1.01972e-4 } },
};

// 讀取數值並轉換到基準單位
function valU(id) {
    const v = parseFloat(document.getElementById(id).value) || 0;
    const fu = fieldUnits[id];
    if (!fu) return v;
    const unitSel = document.getElementById(id + '-unit');
    if (!unitSel) return v;
    const factor = fu.units[unitSel.value] || 1;
    return v * factor;
}

// 動態建立單位選擇器
function initUnitSelectors() {
    for (const [id, cfg] of Object.entries(fieldUnits)) {
        const input = document.getElementById(id);
        if (!input) continue;

        // 移除 label 中的單位提示 <span>
        const label = input.closest('.form-group').querySelector('label span');
        if (label) label.remove();

        // 建立 unit select
        const select = document.createElement('select');
        select.id = id + '-unit';
        select.className = 'unit-select';
        for (const [uName] of Object.entries(cfg.units)) {
            const opt = document.createElement('option');
            opt.value = uName;
            opt.textContent = uName;
            if (uName === cfg.dflt) opt.selected = true;
            select.appendChild(opt);
        }

        // 包裝 input + select
        const wrapper = document.createElement('div');
        wrapper.className = 'input-unit-group';
        input.parentNode.insertBefore(wrapper, input);
        wrapper.appendChild(input);
        wrapper.appendChild(select);
    }
}

// ===== 全域單位制切換 =====
function switchUnitSystem(system) {
    if (!system) return;
    const sysDef = unitSystemDefs[system];
    if (!sysDef) return;

    for (const [fieldId, cfg] of Object.entries(fieldUnits)) {
        if (!cfg.dim) continue;
        const targetUnit = sysDef[cfg.dim];
        if (!targetUnit) continue;
        if (!cfg.units[targetUnit]) continue;

        const input = document.getElementById(fieldId);
        const unitSel = document.getElementById(fieldId + '-unit');
        if (!input || !unitSel) continue;

        const currentUnit = unitSel.value;
        if (currentUnit === targetUnit) continue;

        const oldFactor = cfg.units[currentUnit] || 1;
        const newFactor = cfg.units[targetUnit] || 1;
        const currentVal = parseFloat(input.value) || 0;
        const newVal = currentVal * oldFactor / newFactor;

        input.value = parseFloat(newVal.toPrecision(6));
        unitSel.value = targetUnit;
    }
}

// ===== 計算結果單位轉換 =====
function resultInSystem(value, fromUnit, dim) {
    const sys = document.getElementById('unit-system').value;
    if (!sys) return { v: value, u: fromUnit };
    const sysDef = unitSystemDefs[sys];
    const toUnit = sysDef[dim];
    if (!toUnit || toUnit === fromUnit) return { v: value, u: fromUnit };
    const fromF = factorsToSI[fromUnit];
    const toF = factorsToSI[toUnit];
    if (!fromF || !toF) return { v: value, u: fromUnit };
    return { v: value * fromF / toF, u: toUnit };
}

// ===== 梁分析 =====
function calcBeam() {
    const L = valU('beam-L'), w = valU('beam-w');
    const E = valU('beam-E');
    const I = valU('beam-I');
    const Mmax = w * L * L / 8;
    const Vmax = w * L / 2;
    const delta = (5 * w * Math.pow(L, 4)) / (384 * E * I) * 1000; // mm
    const Rmax = w * L / 2;

    const rM = resultInSystem(Mmax, 'kN\u00B7m', 'moment');
    const rV = resultInSystem(Vmax, 'kN', 'force');
    const rR = resultInSystem(Rmax, 'kN', 'force');
    const rD = resultInSystem(delta, 'mm', 'length');

    showResult('beam', [
        ['\u6700\u5927\u5F4E\u77E9 M_max', fmt(rM.v, 2) + ' ' + rM.u],
        ['\u6700\u5927\u526A\u529B V_max', fmt(rV.v, 2) + ' ' + rV.u],
        ['\u652F\u627F\u53CD\u529B R', fmt(rR.v, 2) + ' ' + rR.u],
        ['\u6700\u5927\u6493\u5EA6 \u03B4_max', fmt(rD.v, 3) + ' ' + rD.u],
        ['\u6493\u5EA6\u6BD4 L/\u03B4', 'L/' + fmt(L * 1000 / delta, 0)],
    ]);
}

// ===== 柱載重 =====
function calcColumn() {
    const E = valU('col-E');
    const I = valU('col-I');
    const A = valU('col-A');
    const L = valU('col-L');
    const K = parseFloat(sel('col-K'));
    const P = valU('col-P');
    const Pcr = Math.PI * Math.PI * E * I / Math.pow(K * L, 2);
    const sigma = P / A; // kN/m²
    const sigmaMPa = sigma / 1000;
    const r = Math.sqrt(I / A);
    const slenderness = K * L / r;
    const fs = Pcr / P;

    const rPcr = resultInSystem(Pcr, 'kN', 'force');
    const rSigma = resultInSystem(sigmaMPa, 'MPa', 'stress');
    const rR = resultInSystem(r * 100, 'cm', 'length');

    showResult('column', [
        ['Euler \u631C\u5C48\u8F09\u91CD P_cr', fmt(rPcr.v, 1) + ' ' + rPcr.u],
        ['\u8EF8\u58D3\u61C9\u529B \u03C3', fmt(rSigma.v, 2) + ' ' + rSigma.u],
        ['\u8FF4\u8F49\u534A\u5F91 r', fmt(rR.v, 2) + ' ' + rR.u],
        ['\u7D30\u9577\u6BD4 KL/r', fmt(slenderness, 1)],
        ['\u5B89\u5168\u4FC2\u6578 P_cr/P', fmt(fs, 2)],
        ['\u72C0\u614B', fs >= 1.0 ? '\u2705 \u5B89\u5168' : '\u26A0\uFE0F \u8D85\u904E\u631C\u5C48\u8F09\u91CD\uFF01'],
    ]);
}

// ===== 混凝土用量 =====
function toggleConcShape() {
    const t = sel('conc-type');
    document.getElementById('conc-w-group').style.display = t === 'rect' ? '' : 'none';
    document.getElementById('conc-d-group').style.display = t === 'cylinder' ? '' : 'none';
}

function calcConcrete() {
    const type = sel('conc-type');
    const h = valU('conc-h'), l = valU('conc-l'), n = val('conc-n'), loss = val('conc-loss');
    let vol;
    if (type === 'rect') {
        const w = valU('conc-w');
        vol = w * h * l;
    } else {
        const d = valU('conc-d');
        vol = Math.PI * Math.pow(d / 2, 2) * l;
    }
    const totalVol = vol * n;
    const withLoss = totalVol * (1 + loss / 100);
    const weight = withLoss * 2400;
    const trucks = Math.ceil(withLoss / 9);
    showResult('concrete', [
        ['\u55AE\u652F\u9AD4\u7A4D', fmt(vol, 3) + ' m\u00B3'],
        ['\u7E3D\u9AD4\u7A4D (\u6DE8)', fmt(totalVol, 3) + ' m\u00B3'],
        ['\u542B\u640D\u8017\u9AD4\u7A4D', fmt(withLoss, 3) + ' m\u00B3'],
        ['\u9810\u4F30\u91CD\u91CF', fmt(weight, 0) + ' kg (' + fmt(weight / 1000, 2) + ' t)'],
        ['\u9810\u62CC\u8ECA\u6578 (9m\u00B3/\u8ECA)', trucks + ' \u8ECA'],
    ]);
}

// ===== 鋼筋計算 =====
function calcRebar() {
    const rebarData = {
        3: { dia: 9.53, weight: 0.560, name: 'D10 (#3)' },
        4: { dia: 12.7, weight: 0.994, name: 'D13 (#4)' },
        5: { dia: 15.9, weight: 1.552, name: 'D16 (#5)' },
        6: { dia: 19.1, weight: 2.235, name: 'D19 (#6)' },
        7: { dia: 22.2, weight: 2.985, name: 'D22 (#7)' },
        8: { dia: 25.4, weight: 3.980, name: 'D25 (#8)' },
        9: { dia: 28.7, weight: 5.080, name: 'D29 (#9)' },
        10: { dia: 32.3, weight: 6.390, name: 'D32 (#10)' },
        11: { dia: 35.8, weight: 7.900, name: 'D36 (#11)' },
    };
    const no = sel('rebar-no');
    const len = valU('rebar-len'), qty = val('rebar-qty'), lap = val('rebar-lap');
    const rb = rebarData[no];
    const totalLen = len * qty * (1 + lap / 100);
    const totalWeight = totalLen * rb.weight;
    const area = Math.PI * Math.pow(rb.dia / 2, 2);
    showResult('rebar', [
        ['\u92FC\u7B4B\u898F\u683C', rb.name],
        ['\u76F4\u5F91', rb.dia + ' mm'],
        ['\u55AE\u4F4D\u91CD', rb.weight + ' kg/m'],
        ['\u55AE\u652F\u65B7\u9762\u7A4D', fmt(area, 1) + ' mm\u00B2'],
        ['\u7E3D\u9577\u5EA6 (\u542B\u642D\u63A5)', fmt(totalLen, 2) + ' m'],
        ['\u7E3D\u91CD\u91CF', fmt(totalWeight, 1) + ' kg (' + fmt(totalWeight / 1000, 3) + ' t)'],
    ]);
}

// ===== RC梁撓曲設計 =====
function calcRCBeam() {
    // 所有計算以 kgf-cm 為基準
    const b = valU('rc-b');    // cm
    const h = valU('rc-h');    // cm
    const d = valU('rc-d');    // cm
    const fc = valU('rc-fc');  // kgf/cm²
    const fy = valU('rc-fy');  // kgf/cm²
    const Mu_tfm = valU('rc-Mu'); // tf·m
    const phi = val('rc-phi');

    // 轉換 Mu: tf·m → kgf·cm
    const Mu = Mu_tfm * 1e5; // 1 tf·m = 100000 kgf·cm

    // β1 係數 (ACI 318)
    // f'c 以 MPa 判斷: 1 kgf/cm² = 0.0980665 MPa
    const fc_MPa = fc * 0.0980665;
    let beta1;
    if (fc_MPa <= 28) {
        beta1 = 0.85;
    } else {
        beta1 = 0.85 - 0.05 * (fc_MPa - 28) / 7;
        if (beta1 < 0.65) beta1 = 0.65;
    }

    // 最大鋼筋比 (確保拉力控制, εt ≥ 0.005)
    const rho_max = 0.85 * beta1 * (fc / fy) * (0.003 / (0.003 + 0.005));

    // 最小鋼筋比 (ACI 318-14 §9.6.1.2)
    const rho_min1 = 0.8 * Math.sqrt(fc_MPa) / (fy * 0.0980665);
    const rho_min2 = 14 / fy;
    const rho_min = Math.max(rho_min1, rho_min2);

    // Rn 法求所需鋼筋量
    const Mn_req = Mu / phi; // kgf·cm
    const Rn = Mn_req / (b * d * d); // kgf/cm²

    // 檢查是否超過單筋梁容量
    const Rn_max = rho_max * fy * (1 - 0.59 * rho_max * fy / fc);

    let rho_req, As_req, a, Mn_provided;
    let status = '';
    let isOverReinforced = false;

    if (Rn > Rn_max) {
        isOverReinforced = true;
        rho_req = rho_max;
        As_req = rho_max * b * d;
        a = As_req * fy / (0.85 * fc * b);
        Mn_provided = phi * As_req * fy * (d - a / 2);
    } else {
        // ρ = (0.85 f'c / fy) × (1 - √(1 - 2Rn / (0.85 f'c)))
        const term = 2 * Rn / (0.85 * fc);
        if (term >= 1) {
            isOverReinforced = true;
            rho_req = rho_max;
        } else {
            rho_req = (0.85 * fc / fy) * (1 - Math.sqrt(1 - term));
        }
        // 檢查最小鋼筋比
        if (rho_req < rho_min) rho_req = rho_min;
        As_req = rho_req * b * d;
        a = As_req * fy / (0.85 * fc * b);
        Mn_provided = phi * As_req * fy * (d - a / 2);
    }

    // c 值與淨拉應變
    const c = a / beta1;
    const epsilon_t = 0.003 * (d - c) / c;

    // 判斷狀態
    if (isOverReinforced) {
        status = '\u26A0\uFE0F \u8D85\u904E\u55AE\u7B4B\u6881\u5BB9\u91CF\uFF0C\u9700\u63A1\u96D9\u7B4B\u6881\u6216\u52A0\u5927\u65B7\u9762';
    } else if (epsilon_t >= 0.005) {
        status = '\u2705 \u62C9\u529B\u63A7\u5236\u65B7\u9762 (\u03B5t \u2265 0.005)';
    } else if (epsilon_t >= 0.004) {
        status = '\u26A0\uFE0F \u904E\u6E21\u5340\u65B7\u9762 (0.004 \u2264 \u03B5t < 0.005)';
    } else {
        status = '\u274C \u58D3\u529B\u63A7\u5236\u65B7\u9762 (\u03B5t < 0.004)';
    }

    // 建議配筋
    const rebarOptions = [
        { no: '#4 (D13)', dia: 1.27, area: 1.267 },
        { no: '#5 (D16)', dia: 1.59, area: 1.986 },
        { no: '#6 (D19)', dia: 1.91, area: 2.865 },
        { no: '#7 (D22)', dia: 2.22, area: 3.871 },
        { no: '#8 (D25)', dia: 2.54, area: 5.067 },
        { no: '#9 (D29)', dia: 2.87, area: 6.469 },
        { no: '#10 (D32)', dia: 3.23, area: 8.143 },
    ];
    let suggestion = '';
    for (const rb of rebarOptions) {
        const nBars = Math.ceil(As_req / rb.area);
        const totalAs = nBars * rb.area;
        const clearWidth = b - 2 * 4 - 2 * 1.27; // 假設 4cm 保護層 + #4 箍筋
        const spacing = nBars > 1 ? (clearWidth - nBars * rb.dia) / (nBars - 1) : clearWidth;
        if (spacing >= 2.5 && nBars <= 8) {
            suggestion = nBars + '-' + rb.no + ' (As=' + fmt(totalAs, 2) + ' cm\u00B2)';
            break;
        }
    }
    if (!suggestion) suggestion = '\u8ACB\u8ABF\u6574\u65B7\u9762\u6216\u63A1\u7528\u96D9\u5C64\u914D\u7B4B';

    // 輸出結果 (以 tf·m 和 cm² 顯示)
    const rMu = resultInSystem(Mu_tfm, 'tf\u00B7m', 'moment');
    const rMn = resultInSystem(Mn_provided / 1e5, 'tf\u00B7m', 'moment');

    showResult('rcbeam', [
        ['\u8A2D\u8A08\u5F4E\u77E9 Mu', fmt(rMu.v, 2) + ' ' + rMu.u],
        ['\u6240\u9700\u92FC\u7B4B\u91CF As', fmt(As_req, 2) + ' cm\u00B2'],
        ['\u92FC\u7B4B\u6BD4 \u03C1', fmt(rho_req * 100, 3) + ' %'],
        ['\u6700\u5C0F\u92FC\u7B4B\u6BD4 \u03C1min', fmt(rho_min * 100, 3) + ' %'],
        ['\u6700\u5927\u92FC\u7B4B\u6BD4 \u03C1max', fmt(rho_max * 100, 3) + ' %'],
        ['\u61C9\u529B\u584A\u6DF1\u5EA6 a', fmt(a, 2) + ' cm'],
        ['\u4E2D\u6027\u8EF8\u6DF1\u5EA6 c', fmt(c, 2) + ' cm'],
        ['\u6DE8\u62C9\u61C9\u8B8A \u03B5t', fmt(epsilon_t, 4)],
        ['\u03B21', fmt(beta1, 3)],
        ['\u63D0\u4F9B\u5F4E\u77E9 \u03C6Mn', fmt(rMn.v, 2) + ' ' + rMn.u],
        ['\u5EFA\u8B70\u914D\u7B4B', suggestion],
        ['\u65B7\u9762\u72C0\u614B', status],
    ]);
}

// ===== 單位換算 =====
const unitData = {
    length: {
        units: ['mm', 'cm', 'm', 'km', 'in', 'ft', 'yd'],
        toBase: { mm: 0.001, cm: 0.01, m: 1, km: 1000, in: 0.0254, ft: 0.3048, yd: 0.9144 }
    },
    area: {
        units: ['mm\u00B2', 'cm\u00B2', 'm\u00B2', '\u5761', '\u7532', 'ft\u00B2', 'in\u00B2'],
        toBase: { 'mm\u00B2': 1e-6, 'cm\u00B2': 1e-4, 'm\u00B2': 1, '\u5761': 3305.785, '\u7532': 2934, 'ft\u00B2': 0.0929, 'in\u00B2': 6.4516e-4 }
    },
    volume: {
        units: ['cm\u00B3', 'm\u00B3', 'L', 'gal(US)'],
        toBase: { 'cm\u00B3': 1e-6, 'm\u00B3': 1, 'L': 0.001, 'gal(US)': 0.003785 }
    },
    force: {
        units: ['N', 'kN', 'kgf', 'tf', 'lbf'],
        toBase: { N: 1, kN: 1000, kgf: 9.80665, tf: 9806.65, lbf: 4.44822 }
    },
    pressure: {
        units: ['Pa', 'kPa', 'MPa', 'kgf/cm\u00B2', 'psi', 'atm', 'bar'],
        toBase: { Pa: 1, kPa: 1e3, MPa: 1e6, 'kgf/cm\u00B2': 98066.5, psi: 6894.76, atm: 101325, bar: 1e5 }
    },
    moment: {
        units: ['N\u00B7m', 'kN\u00B7m', 'kgf\u00B7cm', 'kgf\u00B7m', 'tf\u00B7m', 'tf\u00B7cm', 'N\u00B7mm', 'lbf\u00B7ft'],
        toBase: { 'N\u00B7m': 1, 'kN\u00B7m': 1000, 'kgf\u00B7cm': 0.0980665, 'kgf\u00B7m': 9.80665, 'tf\u00B7m': 9806.65, 'tf\u00B7cm': 98.0665, 'N\u00B7mm': 0.001, 'lbf\u00B7ft': 1.35582 }
    }
};

function updateUnitOptions() {
    const cat = sel('unit-cat');
    const units = unitData[cat].units;
    const fromSel = document.getElementById('unit-from');
    const toSel = document.getElementById('unit-to');
    fromSel.innerHTML = units.map((u, i) => `<option value="${u}" ${i === 0 ? 'selected' : ''}>${u}</option>`).join('');
    toSel.innerHTML = units.map((u, i) => `<option value="${u}" ${i === 1 ? 'selected' : ''}>${u}</option>`).join('');
}

function calcUnit() {
    const cat = sel('unit-cat');
    const v = val('unit-val');
    const from = sel('unit-from'), to = sel('unit-to');
    const base = unitData[cat].toBase;
    const result = v * base[from] / base[to];
    showResult('unit', [
        ['\u8F38\u5165', v + ' ' + from],
        ['\u7D50\u679C', fmt(result, 6) + ' ' + to],
    ]);
}

// Init
updateUnitOptions();
initUnitSelectors();
</script>

</body>
</html>
